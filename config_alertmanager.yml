- name: Configuration file
  hosts: local
  tasks:
    - name: insert/update "alert-manager" configuration block in /usr/local/bin/prometheus/prometheus_rules.yml
      blockinfile:
        path: /usr/local/bin/prometheus/prometheus_rules.yml
        insertafter: "expr: 100 - (100 * node_memory_MemFree_bytes / node_memory_MemTotal_bytes)" 
        block: |
          - name: alert_rules
            rules:
              - alert: InstanceDown
                expr: up == 0
                for: 1m
                labels:
                  severity: critical
                annotations:
                  summary: "Instance [{{ $labels.instance }}] down"
                  description: "[{{ $labels.instance }}] of job [{{ $labels.job }}] has been down for more than 1 minute."

